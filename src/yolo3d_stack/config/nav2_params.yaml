costmap:
  costmap:
    ros__parameters:
      # Frame Settings
      global_frame: odom        # The fixed world frame
      robot_base_frame: base_link # The robot itself
      use_sim_time: False
      
      # Performance Tuning (Lower freq = Less CPU usage)
      update_frequency: 5.0     # How often to update the map (Hz)
      publish_frequency: 2.0    # How often to send to RViz (Hz)
      rolling_window: true      # Keep map centered on robot (Local Map)
      width: 10                 # Map width (meters)
      height: 10                # Map height (meters)
      resolution: 0.1           # Grid size (10cm boxes)
      
      # The Layers: What makes up the map?
      plugins: ["obstacle_layer", "inflation_layer"]

      # Layer 1: OBSTACLES (The raw data)
      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        enabled: True
        observation_sources: scan_source yolo_source

        # Source A: Your Virtual Laser (Good for Walls)
        scan_source:
          topic: /scan
          max_obstacle_height: 2.0
          clearing: True   # If the laser sees "nothing", clear the map
          marking: True    # If the laser hits something, mark it
          data_type: "LaserScan"
          raytrace_max_range: 5.0
          obstacle_max_range: 4.5
          inf_is_valid: true

        # Source B: Your YOLO Detections (Good for Specific Objects)
        yolo_source:
          topic: /yolo/obstacle_cloud
          max_obstacle_height: 2.0
          clearing: False  # YOLO only ADDS obstacles, it doesn't clear empty space
          marking: True
          data_type: "PointCloud2"
          obstacle_max_range: 5.0
          min_obstacle_height: -2.0 # Underwater objects might be below "0"

      # Layer 2: INFLATION (The safety buffer)
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0  # Higher = cost drops faster (sharper danger zones)
        inflation_radius: 0.6     # Robot Radius + Safety Margin (meters)